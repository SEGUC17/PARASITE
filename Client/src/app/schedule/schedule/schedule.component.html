<div class="container">
  <mat-card>
    <app-calendar-header
      [(view)]="view"
      [(viewDate)]="viewDate"
      (viewDateChange)="fetchEvents()"
      (viewChange)="fetchEvents()">
    </app-calendar-header>
    <div [ngSwitch]="view">
      <mwl-calendar-month-view
        *ngSwitchCase="'month'"
        [viewDate]="viewDate"
        [events]="events"
        [refresh]="refresh"
        [activeDayIsOpen]="activeDayIsOpen"
        (dayClicked)="dayClicked($event.day)"
        (eventClicked)="handleEvent('Clicked', $event.event)"
        (eventTimesChanged)="eventTimesChanged($event)">
      </mwl-calendar-month-view>

      <mwl-calendar-week-view
        *ngSwitchCase="'week'"
        [viewDate]="viewDate"
        [events]="events">
      </mwl-calendar-week-view>

      <mwl-calendar-day-view
        *ngSwitchCase="'day'"
        [viewDate]="viewDate"
        [events]="events">
      </mwl-calendar-day-view>
    </div>
  </mat-card>
  <div *ngIf="!loggedInUser.isChild">
    <mat-card>
          <h3>
            <button *ngIf="editing"
              mat-raised-button
              color="primary"
              style="width:100px"
              (click)="addEvent()">
              Add Event
            </button>

            <button *ngIf="!editing"
              mat-raised-button
              color="primary"
              style="width:100px"
              (click)="editing=true; refreshDocument()">
              Edit
            </button>
            <div class="clearfix"></div>
          </h3>
          

          <h4 *ngIf="editing" style="overflow-y:scroll; height:800px;">
            <table class="table table-bordered">

              <thead>
                <tr>
                  <th>Title</th>
                  <th>Primary color</th>
                  <th>Secondary color</th>
                  <th>Starts at</th>
                  <th>Ends at</th>
                  <th>Remove</th>
                </tr>
              </thead>

              <tbody>
                <tr *ngFor="let event of events; let index = index">
                  <td>
                    <input
                      type="text"
                      class="form-control"
                      [(ngModel)]="event.title"
                      (keyup)="refreshDocument()">
                  </td>
                  <td>
                    <input
                      type="color"
                      [(ngModel)]="event.color.primary"
                      (change)="refreshDocument()">
                  </td>
                  <td>
                    <input
                      type="color"
                      [(ngModel)]="event.color.secondary"
                      (change)="refreshDocument()">
                  </td>
                  <td>
                    <app-date-time-picker
                      [(ngModel)]="event.start"
                      (ngModelChange)="refreshDocument()"
                      placeholder="Not set">
                    </app-date-time-picker>
                  </td>
                  <td>
                    <app-date-time-picker
                      [(ngModel)]="event.end"
                      (ngModelChange)="refreshDocument()"
                      placeholder="Not set">
                    </app-date-time-picker>
                  </td>
                  <td>
                    <button
                      mat-raised-button
                      color="warn"
                      (click)="events.splice(index, 1); refreshDocument()">
                      Delete
                    </button>
                  </td>
                </tr>
              </tbody>

            </table>
          </h4>
    </mat-card>
    <mat-card *ngIf="editing">
      <div class="button-row">
          <button button (click)="saveScheduleChanges()" mat-raised-button color="primary" style="width:150px">Save Changes</button>
          <button button (click)="cancel()" mat-raised-button color="primary" style="width:150px">Cancel</button>
      </div>
    </mat-card>
  </div>
</div>
